class Animation{move(e){return new Promise((t,i)=>{const a=window.helper.getTranslateValue(e.target),r=Math.floor(a.y),n=Math.floor(a.x),o=!1===e.vertical?r:Math.floor(e.vertical),l=!1===e.horizontal?n:Math.floor(e.horizontal),s=void 0!==e.speed?e.speed:window.player.speed,c=void 0!==e.easing?e.easing:"linear";e.target.animate([{transform:`translate(${n}px, ${r}px)`},{transform:`translate(${l}px, ${o}px)`}],{duration:s,iterations:1,easing:c,fill:"both"}).onfinish=function(e){t(e)}})}}class Backpack{open(){console.log("backpack open")}}class Craft{open(){console.log("craft open")}}class Data{constructor(e){this.api=e,this.apiUrl=`./api/${this.api}/`}loadMap(e){const t={kind:"GET",controller:`${this.apiUrl}map-${e}.${this.api}`};window.helper.ajax(t).then(e=>window.map.buildMap(e))}loadPlayer(){const e={kind:"GET",controller:`${this.apiUrl}player.${this.api}`};window.helper.ajax(e).then(e=>window.player.buildPlayer(e))}}class Enemy{}class Helper{ajax(e){return new Promise((t,i)=>{let a=new XMLHttpRequest;const r=void 0===e.kind?"GET":e.kind;a.open(r,e.controller,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=(()=>{a.status>=200&&a.status<300?t(a.responseText):i(a.statusText)}),a.onerror=(()=>i(a.statusText)),a.send(e.parameter)})}remove(e){null!==e&&e.parentNode.removeChild(e)}getTranslateValue(e){const t=window.getComputedStyle(e).transform;if("none"===t)return{x:0,y:0,z:0};const i=t.includes("3d")?"3d":"2d",a=t.match(/matrix.*\((.+)\)/)[1].split(", ");return"2d"===i?{x:Number(a[4]),y:Number(a[5]),z:0}:"3d"===i?{x:Number(a[12]),y:Number(a[13]),z:Number(a[14])}:void 0}}class Interface{build(){this.update(),this.buildAction(),this.buildDirection()}buildAction(){this.elActionBackpack.onclick=(()=>{backpack.open()}),this.elActionCraft.onclick=(()=>{craft.open()}),this.elActionCatch.onclick=(()=>{player.catch()}),this.elActionHit.onclick=(()=>{player.hit()})}buildDirection(){this.elDirectionalUp.onclick=(()=>{player.move("up")}),this.elDirectionalDown.onclick=(()=>{player.move("down")}),this.elDirectionalLeft.onclick=(()=>{player.move("left")}),this.elDirectionalRight.onclick=(()=>{player.move("right")})}update(){this.elBarLife=document.querySelector('[data-id="bar-life"]'),this.elBarHunger=document.querySelector('[data-id="bar-hunger"]'),this.elBarThirst=document.querySelector('[data-id="bar-thirst"]'),this.elActionBackpack=document.querySelector('[data-id="action-backpack"]'),this.elActionCraft=document.querySelector('[data-id="action-craft"]'),this.elActionCatch=document.querySelector('[data-id="action-catch"]'),this.elActionHit=document.querySelector('[data-id="action-hit"]'),this.elDirectionalUp=document.querySelector('[data-id="directional-up"]'),this.elDirectionalDown=document.querySelector('[data-id="directional-down"]'),this.elDirectionalLeft=document.querySelector('[data-id="directional-left"]'),this.elDirectionalRight=document.querySelector('[data-id="directional-right"]')}updateBar(){this.elBarLife.setAttribute("value",player.lifeCurrent),this.elBarLife.setAttribute("max",player.life),this.elBarHunger.setAttribute("value",player.hungerCurrent),this.elBarHunger.setAttribute("max",player.hunger),this.elBarThirst.setAttribute("value",player.thirstCurrent),this.elBarThirst.setAttribute("max",player.thirst)}}class Item{}class Keyboard{build(){document.addEventListener("keydown",e=>{this.buildAction(e.key)})}buildAction(e){switch(e){case"Up":case"ArrowUp":case"w":window.player.move("up"),window.map.move("up");break;case"Left":case"ArrowLeft":case"a":window.player.move("left"),window.map.move("left");break;case"Down":case"ArrowDown":case"s":window.player.move("down"),window.map.move("down");break;case"Right":case"ArrowRight":case"d":window.player.move("right"),window.map.move("right")}}}class Management{verifyLoad(){document.addEventListener("DOMContentLoaded",()=>{this.build()})}build(){window.interface.build(),window.keyboard.build(),window.map.build(),window.player.build()}}class Map{constructor(){this.current=0,this.json={},this.arr=[],this.tileSize=50,this.unity="px"}build(){this.update(),window.data.loadMap(this.current)}buildMap(e){this.json=JSON.parse(e),this.convertArray(),this.buildHtml()}buildHtml(){const e=this.buildHtmlRow();this.elMap.style.width=`${this.tileSize*this.json.column}${this.unity}`,this.elMap.style.height=`${this.tileSize*this.json.row}${this.unity}`,this.elMap.innerHTML="",this.elMap.insertAdjacentHTML("afterbegin",e)}buildHtmlRow(){let e="";for(let t=0;t<this.json.row;t++)e+=this.buildHtmlColumn(t);return e}buildHtmlColumn(e){let t="";for(let i=0;i<this.json.column;i++){t+=`<div class="tile tile--${this.arr[e][i].trim()}"></div>`}return t}convertArray(){const e=this.json.map,t=Object.keys(e).length;for(let i=0;i<t;i++){let t=e[i].split(",");this.arr[i]=t}}update(){this.elMap=document.querySelector("#map")}move(e){console.log(e)}}class Player{constructor(){this.currentHorizontal=0,this.currentVertical=0,this.tileCurrent=0,this.tileNext=0,this.speed=300,this.isMoving=!1}build(){this.update(),this.load()}update(){this.elPlayer=document.querySelector("#player")}buildPlayer(e){const t=JSON.parse(e);this.life=t.life,this.lifeCurrent=t.lifeCurrent,this.hunger=t.hunger,this.hungerCurrent=t.hungerCurrent,this.thirst=t.thirst,this.thirstCurrent=t.thirstCurrent,window.interface.updateBar()}load(){window.data.loadPlayer()}catch(){console.log("catch")}hit(){console.log("hit")}move(e){const t=window.map.tileSize,i=window.map.json.column;let a,r,n=!1,o=!1;if(!this.isMoving){switch(e){case"up":a=this.tileCurrent-i,n=this.currentVertical-t;break;case"down":a=this.tileCurrent+i,n=this.currentVertical+t;break;case"left":a=this.tileCurrent-1,o=this.currentHorizontal-t;break;case"right":a=this.tileCurrent+1,o=this.currentHorizontal+t}this.isMoving=!0,(r=window.animation.move({target:this.elPlayer,vertical:n,horizontal:o})).then(()=>this.updatePosition({tileNext:a,side:e}))}}updatePosition(e){const t=window.map.tileSize;switch(this.isMoving=!1,this.tileCurrent=e.tileNext,e.side){case"up":this.currentVertical-=t;break;case"down":this.currentVertical+=t;break;case"left":this.currentHorizontal-=t;break;case"right":this.currentHorizontal+=t}}}class Theme{}window.animation=new Animation,window.helper=new Helper,window.data=new Data("json"),window.backpack=new Backpack,window.craft=new Craft,window.enemy=new Enemy,window.interface=new Interface,window.item=new Item,window.keyboard=new Keyboard,window.management=new Management,window.map=new Map,window.player=new Player,window.theme=new Theme,management.verifyLoad();