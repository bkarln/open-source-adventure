class Animation{move(e){return new Promise(t=>{const i=window.helper.getTranslateValue(e.target),r=Math.floor(i.y),a=Math.floor(i.x),n=!1===e.vertical?r:Math.floor(e.vertical),o=!1===e.horizontal?a:Math.floor(e.horizontal),l=void 0!==e.speed?e.speed:window.player.speed,s=void 0!==e.easing?e.easing:"linear";e.target.animate([{transform:`translate(${a}px, ${r}px)`},{transform:`translate(${o}px, ${n}px)`}],{duration:l,iterations:1,easing:s,fill:"both"}).onfinish=function(e){t(e)}})}}window.animation=new Animation;class Backpack{open(){console.log("backpack open")}}window.backpack=new Backpack;class Craft{open(){console.log("craft open")}}window.craft=new Craft;class Data{constructor(e){this.api=e,this.apiUrl=`./api/${this.api}/`}loadMap(e){const t={kind:"GET",controller:`${this.apiUrl}map-${e}.${this.api}`};window.helper.ajax(t).then(e=>window.map.buildMap(e))}loadPlayer(){const e={kind:"GET",controller:`${this.apiUrl}player.${this.api}`};window.helper.ajax(e).then(e=>window.player.buildPlayer(e))}}window.data=new Data("json");class Enemy{}window.enemy=new Enemy;class Helper{ajax(e){return new Promise((t,i)=>{let r=new XMLHttpRequest;const a=void 0===e.kind?"GET":e.kind;r.open(a,e.controller,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onload=(()=>{r.status>=200&&r.status<300?t(r.responseText):i(r.statusText)}),r.onerror=(()=>i(r.statusText)),r.send(e.parameter)})}remove(e){null!==e&&e.parentNode.removeChild(e)}getTranslateValue(e){const t=window.getComputedStyle(e).transform;if("none"===t)return{x:0,y:0,z:0};const i=t.includes("3d")?"3d":"2d",r=t.match(/matrix.*\((.+)\)/)[1].split(", ");return"2d"===i?{x:Number(r[4]),y:Number(r[5]),z:0}:"3d"===i?{x:Number(r[12]),y:Number(r[13]),z:Number(r[14])}:void 0}}window.helper=new Helper;class Interface{build(){this.update(),this.buildAction(),this.buildDirection()}buildAction(){this.elActionBackpack.onclick=(()=>{backpack.open()}),this.elActionCraft.onclick=(()=>{craft.open()}),this.elActionCatch.onclick=(()=>{player.catch()}),this.elActionHit.onclick=(()=>{player.hit()})}buildDirection(){this.elDirectionalUp.onclick=(()=>{player.move("up")}),this.elDirectionalDown.onclick=(()=>{player.move("down")}),this.elDirectionalLeft.onclick=(()=>{player.move("left")}),this.elDirectionalRight.onclick=(()=>{player.move("right")})}update(){this.elBarLife=document.querySelector('[data-id="bar-life"]'),this.elBarHunger=document.querySelector('[data-id="bar-hunger"]'),this.elBarThirst=document.querySelector('[data-id="bar-thirst"]'),this.elActionBackpack=document.querySelector('[data-id="action-backpack"]'),this.elActionCraft=document.querySelector('[data-id="action-craft"]'),this.elActionCatch=document.querySelector('[data-id="action-catch"]'),this.elActionHit=document.querySelector('[data-id="action-hit"]'),this.elDirectionalUp=document.querySelector('[data-id="directional-up"]'),this.elDirectionalDown=document.querySelector('[data-id="directional-down"]'),this.elDirectionalLeft=document.querySelector('[data-id="directional-left"]'),this.elDirectionalRight=document.querySelector('[data-id="directional-right"]')}updateBar(){this.elBarLife.setAttribute("value",player.lifeCurrent),this.elBarLife.setAttribute("max",player.life),this.elBarHunger.setAttribute("value",player.hungerCurrent),this.elBarHunger.setAttribute("max",player.hunger),this.elBarThirst.setAttribute("value",player.thirstCurrent),this.elBarThirst.setAttribute("max",player.thirst)}}window.interface=new Interface;class Item{}window.item=new Item;class Keyboard{build(){document.addEventListener("keydown",e=>{this.buildAction(e.key)})}buildAction(e){switch(e){case"Up":case"ArrowUp":case"w":window.player.move("up"),window.map.move("up");break;case"Left":case"ArrowLeft":case"a":window.player.move("left"),window.map.move("left");break;case"Down":case"ArrowDown":case"s":window.player.move("down"),window.map.move("down");break;case"Right":case"ArrowRight":case"d":window.player.move("right"),window.map.move("right")}}}window.keyboard=new Keyboard;class Map{constructor(){this.current=0,this.json={},this.arr=[],this.tileSize=50,this.unity="px"}build(){this.update(),window.data.loadMap(this.current)}buildMap(e){this.json=JSON.parse(e),this.convertArray(),this.buildHtml()}buildHtml(){const e=this.buildHtmlRow();this.elMap.style.width=`${this.tileSize*this.json.column}${this.unity}`,this.elMap.style.height=`${this.tileSize*this.json.row}${this.unity}`,this.elMap.innerHTML="",this.elMap.insertAdjacentHTML("afterbegin",e)}buildHtmlRow(){let e="";for(let t=0;t<this.json.row;t++)e+=this.buildHtmlColumn(t);return e}buildHtmlColumn(e){let t="";for(let i=0;i<this.json.column;i++){t+=`<div class="tile tile--${this.arr[e][i].trim()}"></div>`}return t}convertArray(){const e=this.json.map,t=Object.keys(e).length;for(let i=0;i<t;i++){let t=e[i].split(",");this.arr[i]=t}}update(){this.elMap=document.querySelector("#map")}move(e){console.log(e)}}window.map=new Map;class Player{constructor(){this.currentHorizontal=0,this.currentVertical=0,this.tileCurrent=0,this.tileNext=0,this.speed=300,this.isMoving=!1}build(){this.update(),this.load()}update(){this.elPlayer=document.querySelector("#player")}buildPlayer(e){const t=JSON.parse(e);this.life=t.life,this.lifeCurrent=t.lifeCurrent,this.hunger=t.hunger,this.hungerCurrent=t.hungerCurrent,this.thirst=t.thirst,this.thirstCurrent=t.thirstCurrent,window.interface.updateBar()}load(){window.data.loadPlayer()}catch(){console.log("catch")}hit(){console.log("hit")}move(e){const t=window.map.tileSize,i=window.map.json.column;let r,a,n=!1,o=!1;if(!this.isMoving){switch(e){case"up":r=this.tileCurrent-i,n=this.currentVertical-t;break;case"down":r=this.tileCurrent+i,n=this.currentVertical+t;break;case"left":r=this.tileCurrent-1,o=this.currentHorizontal-t;break;case"right":r=this.tileCurrent+1,o=this.currentHorizontal+t}this.isMoving=!0,(a=window.animation.move({target:this.elPlayer,vertical:n,horizontal:o})).then(()=>this.updatePosition({tileNext:r,side:e}))}}updatePosition(e){const t=window.map.tileSize;switch(this.isMoving=!1,this.tileCurrent=e.tileNext,e.side){case"up":this.currentVertical-=t;break;case"down":this.currentVertical+=t;break;case"left":this.currentHorizontal-=t;break;case"right":this.currentHorizontal+=t}}}window.player=new Player;class Theme{}window.theme=new Theme,document.addEventListener("DOMContentLoaded",()=>{window.interface.build(),window.keyboard.build(),window.map.build(),window.player.build()});