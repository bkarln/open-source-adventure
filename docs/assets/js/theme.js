class Animation{move(e){return new Promise(t=>{const i=window.helper.getTranslateValue(e.target),a=Math.floor(i.y),n=Math.floor(i.x),r=void 0===e.vertical?a:Math.floor(e.vertical),o=void 0===e.horizontal?n:Math.floor(e.horizontal),s=void 0===e.speed?window.player.speed:e.speed,l=void 0===e.easing?"linear":e.easing;e.target.animate([{transform:`translate(${n}px, ${a}px)`},{transform:`translate(${o}px, ${r}px)`}],{duration:s,iterations:1,easing:l,fill:"both"}).onfinish=function(e){t(e)}})}}export{Animation};class Backpack{constructor(){this.objItem={},this.isUpdate=!1}addItem(e){const t=Number(e.getAttribute("data-item")),i=Number(e.getAttribute("data-amount"));this.isUpdate=!0,void 0===this.objItem[t]?this.objItem[t]=i:this.objItem[t]+=i}build(){let e="";for(let t in this.objItem)e+=this.buildHtml(t,this.objItem[t]);window.interface.elPageBackpackContent.innerHTML=e}buildHtml(e,t){return`\n            <div class="item-wrapper">\n                <div class="item item--${e} tile center"></div>\n                <input class="input" type="number" value="${t}" aria-label="number">\n            </div>\n        `}open(){window.modal.open("backpack"),this.isUpdate&&(this.isUpdate=!1,this.build())}}export{Backpack};class Camera{center(){const e=window.helper.getTranslateValue(window.interface.elPlayer);this.update(),window.animation.move({target:window.interface.elCamera,vertical:this.centerVertical(e),horizontal:this.centerHorizontal(e),speed:0})}centerHorizontal(e){const t=Number(-e.x+window.interface.elGameWidth/2-window.map.tileSizeHalf);return this.centerLimit(t,this.limit.centerHorizontal)}centerVertical(e){const t=Number(-e.y+window.interface.elGameHeight/2-window.map.tileSizeHalf);return this.centerLimit(t,this.limit.centerVertical)}centerLimit(e,t){return e<t?t:e>0?0:e}move(e){window.player.verifyWalk(e)||window.player.isMoving||(window.player.move(e),this.moveCamera(e))}moveCamera(e){const t=this.limit[e],i=window.helper.capitalize(e),a=window.helper.getTranslateValue(window.interface.elCamera);this[`verifyLimit${i}`]({limit:t,currentPosition:a})||this.moveCameraAnimate({side:e,currentPosition:a})}moveCameraAnimate(e){const t=e.currentPosition.x,i=e.currentPosition.y;let a,n={target:window.interface.elCamera};switch(e.side){case"down":a=Math.round(i-this.distance),Math.abs(window.camera.limit.down)-Math.abs(i)<this.distance&&(a=window.camera.limit.down),n.vertical=a;break;case"left":a=Math.round(t+this.distance),Math.abs(t)<this.distance&&(a=window.camera.limit.left),n.horizontal=a;break;case"up":a=Math.round(i+this.distance),Math.abs(a)<=this.distance&&(a=this.limit.up),n.vertical=a;break;case"right":a=Math.round(t-this.distance),window.interface.elGameWidth/2-this.distance-Math.abs(t)<this.distance&&(a=-1*window.camera.limit.right),n.horizontal=a}window.animation.move(n)}update(){this.distance=window.map.tileSize,this.limit={centerVertical:Number(-(window.map.height-window.interface.elGameHeight)),centerHorizontal:Number(-(window.map.width-window.interface.elGameWidth)),up:0,down:-1*Math.abs(window.map.tileSize*window.map.json.row-window.interface.elGameHeight),left:0,right:window.map.tileSize*window.map.json.column-window.interface.elGameWidth}}verifyLimitDown(e){const t=e.currentPosition.y;return e.limit>t}verifyLimitLeft(e){const t=e.currentPosition.x;return!(e.limit>t)}verifyLimitRight(e){const t=Math.abs(e.currentPosition.x);return e.limit<t}verifyLimitUp(e){const t=e.currentPosition.y;return e.limit<t}}export{Camera};class Craft{open(){window.modal.open("craft")}}export{Craft};class Data{loadMap(e){const t={controller:`${this.apiUrl}map-${e}.${this.extension}`};window.helper.ajax(t).then(e=>{window.map.buildMap(e)}).then(()=>{this.loadPlayer()}).then(()=>{window.enemy.build(),this.save()})}loadPlayer(){window.player.isInitial?(window.player.isInitial=!1,this.loadPlayerInitial()):window.loadingMain.hide()}loadPlayerInitial(){const e={controller:`${this.apiUrl}player.${this.extension}`};window.helper.ajax(e).then(e=>{window.player.buildPlayer(e)})}save(){const e={controller:`${this.apiUrl}save.${this.extension}`};window.helper.ajax(e).then(e=>{console.log(e)})}update(e){this.extension=e.extension,this.dataBase=e.extension,this.folderDefault=`./api-${this.extension}/`,this.apiUrl=`${this.folderDefault}/`}}export{Data};class Enemy{constructor(){this.cssEnemy="enemy"}build(){this.enemyLength=window.map.json.enemy.quantity;const e=this.buildHtml();window.interface.elEnemy.innerHTML=e,this.setPosition()}buildHtml(){let e="";for(let t=0;t<this.enemyLength;t++){let i=window.helper.raffleArray(window.map.json.enemy.kind);e+=`\n                <div id="${this.cssEnemy}_${t}"\n                    class="tile center ${this.cssEnemy} ${this.cssEnemy}--${i}"\n                    data-amount="1"\n                    data-tile=""\n                >\n                    Enemy ${t}\n                </div>\n            `}return e}setPosition(){for(let e=0;e<this.enemyLength;e++){const t=document.querySelector(`#${this.cssEnemy}_${e}`),i=window.map.rafflePosition();t.setAttribute("data-tile",i),window.map.position({target:t,position:i})}}}export{Enemy};class Game{initialize(){window.data.loadMap(window.map.current)}}export{Game};class Helper{ajax(e){return new Promise((t,i)=>{let a=new XMLHttpRequest;const n=void 0===e.kind?"GET":e.kind;a.open(n,e.controller,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=(()=>{a.status>=200&&a.status<300?t(a.responseText):i(a.statusText)}),a.onerror=(()=>i(a.statusText)),a.send(e.parameter)})}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}getOffset(e){if(!e)return;const t=e.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left}}getTranslateValue(e){const t=window.getComputedStyle(e).transform;if("none"===t)return{x:0,y:0,z:0};const i=t.includes("3d")?"3d":"2d",a=t.match(/matrix.*\((.+)\)/)[1].split(", ");return"2d"===i?{x:Number(a[4]),y:Number(a[5]),z:0}:"3d"===i?{x:Number(a[12]),y:Number(a[13]),z:Number(a[14])}:void 0}raffleNumber(e){return e.minimum+Math.round((e.maximum-e.minimum)*Math.random())}raffleArray(e){return e[Math.floor(Math.random()*e.length)]}remove(e){null!==e&&e.parentNode.removeChild(e)}}export{Helper};class Interface{build(){this.update(),this.resize(),this.buildAction(),this.buildDirection()}buildAction(){this.elActionBackpack.onclick=(()=>{window.backpack.open()}),this.elActionCraft.onclick=(()=>{window.craft.open()}),this.elActionPick.onclick=(()=>{window.pick.pick()}),this.elActionHit.onclick=(()=>{window.player.hit()})}buildDirection(){this.elDirectionalUp.onclick=(()=>{window.camera.move("up")}),this.elDirectionalDown.onclick=(()=>{window.camera.move("down")}),this.elDirectionalLeft.onclick=(()=>{window.camera.move("left")}),this.elDirectionalRight.onclick=(()=>{window.camera.move("right")})}update(){this.elCamera=document.querySelector("#camera"),this.elGame=document.querySelector("#game"),this.elMap=document.querySelector("#map"),this.elPlayer=document.querySelector("#player"),this.elEnemy=document.querySelector(`#${window.enemy.cssEnemy}`),this.elResource=document.querySelector(`#${window.resource.cssResource}`),this.elPageBackpack=document.querySelector("#page_backpack"),this.elPageBackpackContent=this.elPageBackpack.querySelector(".content"),this.elPageCraft=document.querySelector("#page_craft"),this.elPageCraftContent=this.elPageCraft.querySelector(".content"),this.elBarLife=document.querySelector('[data-id="bar-life"]'),this.elBarHunger=document.querySelector('[data-id="bar-hunger"]'),this.elBarThirst=document.querySelector('[data-id="bar-thirst"]'),this.elActionBackpack=document.querySelector('[data-id="action-backpack"]'),this.elActionCraft=document.querySelector('[data-id="action-craft"]'),this.elActionPick=document.querySelector('[data-id="action-pick"]'),this.elActionHit=document.querySelector('[data-id="action-hit"]'),this.elDirectionalUp=document.querySelector('[data-id="directional-up"]'),this.elDirectionalDown=document.querySelector('[data-id="directional-down"]'),this.elDirectionalLeft=document.querySelector('[data-id="directional-left"]'),this.elDirectionalRight=document.querySelector('[data-id="directional-right"]')}updateBar(){this.elBarLife.setAttribute("value",player.lifeCurrent),this.elBarLife.setAttribute("max",player.life),this.elBarHunger.setAttribute("value",player.hungerCurrent),this.elBarHunger.setAttribute("max",player.hunger),this.elBarThirst.setAttribute("value",player.thirstCurrent),this.elBarThirst.setAttribute("max",player.thirst)}resize(){this.elGameWidth=this.elGame.offsetWidth,this.elGameHeight=this.elGame.offsetHeight}}export{Interface};class Keyboard{build(){document.addEventListener("keydown",e=>{this.buildAction(e.key)})}buildAction(e){switch(e){case"Up":case"ArrowUp":case"w":window.camera.move("up");break;case"Left":case"ArrowLeft":case"a":window.camera.move("left");break;case"Down":case"ArrowDown":case"s":window.camera.move("down");break;case"Right":case"ArrowRight":case"d":window.camera.move("right");break;case"Escape":window.modal.close();break;case"b":window.backpack.open();break;case"c":window.craft.open();break;case"p":window.pick.pick();break;case"h":window.player.hit()}}}export{Keyboard};class LoadingMain{constructor(){this.cssHide="hide",this.cssAnimation="animate"}update(){this.elWrapper=document.querySelector(".loading-main"),this.elLoading=this.elWrapper.querySelector(".loading")}hide(){this.elWrapper.classList.add(this.cssHide),this.elLoading.classList.remove(this.cssAnimation)}show(){this.elWrapper.classList.remove(this.cssHide),this.elLoading.classList.add(this.cssAnimation)}}export{LoadingMain};class Map{constructor(){this.current=1,this.json={},this.arr=[],this.arrWalkFalse=[0],this.arrDoor=[2],this.tileSize=50,this.tileSizeHalf=this.tileSize/2,this.tileId=0,this.tileIdPrefix="tile_",this.tileTotal=0}buildMap(e){this.json=JSON.parse(e),this.width=this.tileSize*this.json.column,this.height=this.tileSize*this.json.row,window.camera.update(),this.update(),this.convertArray(),this.buildHtml(),window.enemy.build(),window.resource.build(),window.player.isInitial||window.player.position()}buildHtml(){const e=this.buildHtmlRow();window.interface.elMap.style.width=`${this.width}px`,window.interface.elMap.style.height=`${this.height}px`,window.interface.elMap.innerHTML="",window.interface.elMap.insertAdjacentHTML("afterbegin",e)}buildHtmlRow(){let e="";for(let t=0;t<this.json.row;t++)e+=this.buildHtmlColumn(t);return e}buildHtmlColumn(e){let t="";for(let i=0;i<this.json.column;i++){let a=this.arr[e][i],n=Number(a.trim()),r=this.arrWalkFalse.includes(n),o=this.arrDoor.includes(n);(r||o)&&this.arrForbidden.push(this.tileId),t+=`<div class="tile tile--${n}" data-tile="${n}" id="${this.tileIdPrefix}${this.tileId}"></div>`,this.tileId++}return t}convertArray(){const e=this.json.map,t=Object.keys(e).length;for(let i=0;i<t;i++){let t=e[i].split(",");this.arr[i]=t}}change(){const e=window.player.tileCurrent,t=window.map.json.position;let i,a;window.loadingMain.show();for(let n in t)t.hasOwnProperty(n)&&t[n].tile===e&&(i=t[n].sendToMap,a=t[n].sendToTile);this.update(),window.player.tileCurrent=a,window.data.loadMap(i)}position(e){const t=e.target;if(!t)return;const i=this.tileIdPrefix+e.position,a=document.querySelector(`#${i}`),n=window.helper.getOffset(a),r=window.helper.getOffset(window.interface.elCamera),o={top:n.top-r.top,left:n.left-r.left};window.animation.move({target:t,vertical:Math.round(o.top),horizontal:Math.round(o.left),speed:0})}rafflePosition(){let e=this.rafflePositionRandom();for(;this.arrForbidden.includes(e);)e=this.rafflePositionRandom();return this.arrForbidden.push(e),e}rafflePositionRandom(){return window.helper.raffleNumber({minimum:0,maximum:window.map.tileTotal})}removeItem(e){window.helper.remove(e)}removeResource(e){const t=this.arrResource,i=t.indexOf(Number(e));i>-1&&t.splice(i,1)}verifyDoor(e){return this.verifyTile({tile:e,arr:"arrDoor"})}verifyResource(e){return this.arrResource.includes(e)}verifyWalk(e){return this.verifyTile({tile:e,arr:"arrWalkFalse"})}verifyTile(e){const t=document.querySelector(`#${this.tileIdPrefix}${e.tile}`),i=Number(t.getAttribute("data-tile"));return!!this[e.arr].includes(i)}update(){this.tileId=0,this.tileTotal=window.map.json.row*window.map.json.column,this.arrForbidden=[],this.arrResource=[]}}export{Map};class Modal{constructor(){this.cssModal="modal",this.cssClose=`${this.cssModal}--close`,this.cssHide="hide"}build(){this.update(),this.buildAction()}buildAction(){this.elCloseButton.onclick=(()=>{this.close()})}close(){this.hidePage(),this.elModal.classList.add(this.cssClose)}open(e){const t=document.querySelector(`#page_${e}`);this.hidePage(),this.elModal.classList.remove(this.cssClose),t.classList.remove(this.cssHide)}hidePage(){Array.prototype.forEach.call(this.elPage,e=>{e.classList.contains(this.cssHide)||e.classList.add(this.cssHide)})}update(){this.elModal=document.querySelector(`.${this.cssModal}`),this.elContent=document.querySelector(`.${this.cssModal}__content`),this.elPage=this.elContent.querySelectorAll(".page"),this.elCloseButton=document.querySelector("#modal_close")}}export{Modal};class Pick{constructor(){this.isPick=!1}pick(){if(!this.isPick)return;const e=window.player.tileCurrent,t=window.interface.elResource.querySelector(`[data-tile="${e}"]`),i=t.getAttribute("data-tile");window.map.removeItem(t),window.map.removeResource(i),window.backpack.addItem(t),this.setPick(!1)}setPick(e){const t=window.interface.elActionPick;e?t.removeAttribute("disabled"):t.setAttribute("disabled",""),this.isPick=e}}export{Pick};class Player{constructor(){this.speed=0,this.isMoving=!1,this.isInitial=!0}buildPlayer(e){this.buildVariable(e),window.interface.updateBar(),this.position(),window.loadingMain.hide()}buildVariable(e){const t=JSON.parse(e);this.life=t.life,this.lifeCurrent=t.lifeCurrent,this.hunger=t.hunger,this.hungerCurrent=t.hungerCurrent,this.thirst=t.thirst,this.thirstCurrent=t.thirstCurrent,this.tileCurrent=window.map.json.position.player,this.speed=t.speed}hit(){console.log("hit")}move(e){const t=this.moveCoordinates(e);let i,a={target:window.interface.elPlayer};const n=void 0!==t.tileNext?a.tileNext=t.tileNext:void 0;void 0!==t.vertical&&(a.vertical=t.vertical),void 0!==t.horizontal&&(a.horizontal=t.horizontal),this.isMoving||(this.isMoving=!0,(i=window.animation.move(a)).then(()=>this.moveSuccess({tileNext:n,side:e})))}moveSuccess(e){const t=window.map.verifyDoor(e.tileNext),i=window.map.verifyResource(e.tileNext);this.updatePosition({tileNext:e.tileNext,side:e}),t&&window.map.change(),window.pick.setPick(i)}moveCoordinates(e){const t=window.map.json.column,i=window.helper.getTranslateValue(window.interface.elPlayer);let a={};switch(e){case"up":a.tileNext=this.tileCurrent-t,a.vertical=i.y-window.camera.distance;break;case"down":a.tileNext=this.tileCurrent+t,a.vertical=i.y+window.camera.distance;break;case"left":a.tileNext=this.tileCurrent-1,a.horizontal=i.x-window.camera.distance;break;case"right":a.tileNext=this.tileCurrent+1,a.horizontal=i.x+window.camera.distance}return a}position(){window.map.position({target:window.interface.elPlayer,position:this.tileCurrent}),window.camera.center()}updatePosition(e){switch(this.isMoving=!1,this.tileCurrent=e.tileNext,e.side){case"up":this.currentVertical-=window.map.tileSize;break;case"down":this.currentVertical+=window.map.tileSize;break;case"left":this.currentHorizontal-=window.map.tileSize;break;case"right":this.currentHorizontal+=window.map.tileSize}}verifyWalk(e){const t=this.moveCoordinates(e);let i={target:window.interface.elPlayer};const a=void 0!==t.tileNext?i.tileNext=t.tileNext:void 0;return window.map.verifyWalk(a)}}export{Player};class Resource{constructor(){this.cssResource="resource",this.cssItem="item"}build(){this.resourceLength=window.map.json.resource.quantity;const e=this.buildHtml();window.interface.elResource.innerHTML=e,this.setPosition()}buildHtml(){let e="";for(let t=0;t<this.resourceLength;t++){let i=window.helper.raffleArray(window.map.json.resource.kind);e+=`\n                <div id="${this.cssItem}_${t}"\n                    class="${this.cssItem} ${this.cssItem}--${i} tile center" data-item="${i}"\n                    data-amount="1"\n                    data-tile=""\n                >\n                    Item ${t}\n                </div>\n            `}return e}setPosition(){for(let e=0;e<this.resourceLength;e++){const t=document.querySelector(`#${this.cssItem}_${e}`),i=window.map.rafflePosition();t.setAttribute("data-tile",i),window.map.arrResource.push(i),window.map.position({target:t,position:i})}}}export{Resource};window.animation=new Animation,window.backpack=new Backpack,window.camera=new Camera,window.craft=new Craft,window.data=new Data,window.enemy=new Enemy,window.game=new Game,window.helper=new Helper,window.interface=new Interface,window.keyboard=new Keyboard,window.loadingMain=new LoadingMain,window.map=new Map,window.modal=new Modal,window.pick=new Pick,window.player=new Player,window.resource=new Resource,document.addEventListener("DOMContentLoaded",()=>{window.data.update({extension:"js",dataBase:"localStorage"}),window.loadingMain.update(),window.modal.build(),window.map.update(),window.interface.build(),window.keyboard.build(),window.game.initialize()}),window.addEventListener("resize",()=>{window.interface.resize(),window.camera.center()});